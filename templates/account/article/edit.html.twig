{% extends 'base.html.twig' %}

{% block title %}{{ parent() }} | {{ title }}{% endblock %}

{% block body %}
 
    <section id="editArticle">
        <div class="overlayLoading" id="overlayLoading"><span class="loader"><p>Chargement en cours...</p></span></div>
      
            {{include('partials/_navbarMenu.html.twig')}}

        <div class="container-fluid wrapper">
            
            {{include('partials/_sidebarMenuProfile.html.twig')}}  
            
            <div class="row">
            <h3>Modification de l'article <i>"{{article.title}}"</i> </h3> 
                <div class="col-md-6 col-sm-12">
                    <h5><i class="fa-solid fa-pen"></i> Contenu de l'article</h5>
                    {{form_start(form)}}
                        {{form_row(form.title)}}
                        {{form_row(form.category)}}   
                        {{form_row(form.content)}}
                         {% if is_granted("ROLE_ADMIN") %}
                            {{form_row(form.adminNews)}}
                        {% endif %}
                </div>
               
                <div class="col-md-6 col-sm-12">
                    <h5><i class="fa-solid fa-film"></i> Ajouter ou modifier une vidéo...</h5>
                        {{form_row(form.video.title)}}
                        {{form_row(form.video.source)}}
                        
                        <h5><i class="fa-brands fa-youtube"></i></i> ...Ou insérez un lien Youtube</h5>
                        {{form_row(form.video.link)}}
                                           
                    <h5 class="mt-3"><i class="fa-solid fa-images"></i> Ajouter des images</h5>
                        {{form_row(form.images)}}

                    {% if article.images is not empty %}
                    <h5 class="mt-3"><i class="fa-solid fa-images"></i> Supprimer des images</h5>
                        <div class="d-flex flex-row flex-wrap">
                           {% for image in article.images %}
                            <div class="thumbnail-edit"> 
                                <img src="{{asset('/uploads/article/image/'~ image.source)}}" class="img-thumbnail img-fluid">
                                <a href="{{path('article_image_delete', {'id': image.id })}}" class="btn btn-sm btn-danger" data-delete data-token="{{ csrf_token('delete' ~ image.id )}}"> X </a>
                            </div>
                            {% endfor %}
                       </div>
                    {% endif %}
                     
                   

                </div> 
                    <div>
                        <a href="{{path('account_articles')}}" class="btn btn-dark btn-lg"><i class="fa-solid fa-chevron-left"></i> Retour</a>
                        <button type="submit" id="modifyButton" class="btn btn-warning btn-lg m-3">Modifier</button>
                    </div>
                    
                    {{form_end(form)}}
            </div>
                
        </div>
 
    </section>

     <script>
    // loader le temps que l'upload se fasse , avant la redirection
    const button = document.getElementById("modifyButton");
    const loader = document.getElementById("overlayLoading");
        
    loader.classList.add('d-none');

    button.addEventListener('click', function(e){
        loader.classList.remove('d-none');
        loader.classList.add('d-block');
    });
    

   window.onload = () => {
    // Gestion des boutons "Supprimer"
    let links = document.querySelectorAll("[data-delete]")
    
    // On boucle sur links
    for(let link of links){

        link.addEventListener("click", function(e){
            e.preventDefault();
            // On demande confirmation avant de supprimer
            if(confirm("Voulez-vous supprimer cette image ?")){
                
                // On envoie une requête Ajax vers le href du lien avec la méthode DELETE
                fetch(this.getAttribute("href"), {
                    method: "DELETE",
                    headers: {
                        "X-Requested-With": "XMLHttpRequest",
                        "Content-Type": "application/json"
                    }
                }).then(
                    // On récupère la réponse en JSON
                    response => response.json()
                ).then(data => {
                    if(data.success)
                        this.parentElement.remove()
                    else
                        alert(data.error)
                })
            }
        })
    }
}
    

   
    </script>
{% endblock %}








